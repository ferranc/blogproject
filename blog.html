<html lang="en"><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">


    <title>What are they talking about?</title>

    <!-- Bootstrap core CSS -->
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="bootstrap/css/blog.css" rel="stylesheet">
    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
 

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
	
	 </head>

   <div class="navbar-wrapper">
      <div class="container">

        <nav class="navbar navbar-inverse navbar-static-top">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="true" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand">What are they talking about?</a>
            </div>
			<div id="navbar" class="navbar-collapse collapse">
              <ul class="nav navbar-nav">
				<li><a href="./index.html">Home</a></li>
				<li><a href="./the_radar.html">The Radar</a></li>
                <li><a href="./the_analysis.html">The Analysis</a></li>
				<li><a href="./politilines.html">Politilines</a></li>
				<li><a href="./words_they_used.html">Words They Used</a></li>
				<li class="active"><a>Blog</a></li>
              </ul>
            </div>
          </div>
        </nav>

      </div>
    </div>

  <body>

    <div class="container">

      <div class="blog-header">
        <h1 class="blog-title">What are they talking about?</h1>
        <p class="lead blog-description">The process: How we have done it?</p>
      </div>

      <div class="row">

        <div class="col-sm-8 blog-main">

          <div class="blog-post">
            <h2 class="blog-post-title">How does the CIS's Barometer work?</h2>
			<p> <br>  Every month 2.500 legal age people are selected randomly and proportional taking into consideration other variables as age, sex, population and environment ( <a href="http://www.cis.es/cis/export/sites/default/-Archivos/NotasdeInvestigacion/NI004_MetodologiaBarometros_Informe.pdf"> more information about the method </a>)
				This people are interviewed personally at home by CIS agents. The result of the surveys is what the barometers show to us.
				<br><br>   In this barometers we see two blocks of questions. The first one is always the same and the other can change and ask about a recent political or social issues. Is from the first block where we have selected two fix questions for our study:</p>
			 <blockquote>
              <li> ¿Cuál es, a su juicio, el principal problema que existe actualmente en España?¿Y el segundo?¿Y el tercero?(RESPUESTA ESPONTÁNEA) -Available since mar'06</li>
			    <li> ¿Cuáles son, a su juicio, los tres problemas principales que existen actualmente en España?(MÁXIMO TRES RESPUESTAS) -Available from sep'00 to feb'06</li></p>
            </blockquote>
			<p> The answers to this two questions are the three main problems that we have in Spain in opinion of the Spanish Society and is what we are going to use for our study.
			<br><br> We can find all the barometers in the <a href="http://www.cis.es/cis/opencm/EN/11_barometros/depositados.jsp">Data Bank</a>.</p>
		</div><!-- /.blog-post -->

		<div class="blog-post">
            <h2 class="blog-post-title">How do the Control Sessions to the Government in the Congress of Deputies work?</h2>
			<p><br>There are many kinds of session done in the Congress, however we selected the Control Sessions that are taking place every Wednesday. Although they are not defined by the Constitution, they have become very popular over the years and now are ones of the most popular. Is in this sessions where the different political groups can ask to the Government and Ministers about the new laws that are in process or recently approved or talk about detected problems and they must answer.
				<br><br> The session diaries are completely available in their web page by a <a href="http://www.congreso.es/portal/page/portal/Congreso/Congreso/Publicaciones">search engine</a>.
				<br><br> The procedure of this sessions is easy. The different political groups have to deliver to the President of the Congress the questions before Friday midnight. Once approved they can be asked in the session. If a recent and more important issue appear before, the question can be changed until Sunday midnight. The sessions consists in the questions, that are answered by the Government, and the political groups can response again. </p>
		</div>		
		
		<div class="blog-post">
            <h2 class="blog-post-title">The Scrapping</h2>
			<p><br>  The Scrapping is the process from which we extract the information from the web to use them. In this case we have done it with the CIS barometers using its data bank and the Congress using the Search Engine. 
				<br> For this part of the process we have used Python, in particular Selenium and BeautifulSoup. </p>
			<h3> <br> CIS </h3>
			<p> Using Selenium we have download the content of all the barometers and with the help of BeautifulSoup we have searched the question and create a database with the results. 
			<br><br> The database is a Python dictionary and we save it in MongoDB. In this we keep the date when the data was uploaded in the data bank, the title of the barometer (month and year), the url, the kind of document (html or pdf) and the answers to the questions. An example:</p>
			<img src="images/cis_dic.png" alt="CIS Dictionary" width="500" height="400">
			<p><br>As answer we have 30 diferent topics each months, that means that durting all the period (from sept'00 to feb'15) we have found 150 different topics. It's impossible to visualize all those topics and lots of them where similar. Because of this we create 14 clusters: Education, Health, Corruption, Environment, Public Services, Ideology, Economy, Employment, Youth, Justice, Social, Terrorism, Housing, Public Safety and others. 
			<br><br> Once we have this new classification we will put into groups the data and obtain the information that is need for the charts. </p>
			<h3><br> The Congress of Deputies</h3>
			<p><br>We have used Selenium again to download the Session Control diaries. This diaries contain all the information about the speech on the Congress in all the sessions. The first thing we have to do once we have the information is divide the diary  in speech. For this we have used again selenium and this is what we achieve:</p>
				<img src="images/congres1.png" alt="Congress Document" width="700" height="1000">
			<p><br> We can see that is possible to divide the session by speech and in every speech we can keep the information of question, answer and deputie. We	are going to paint every speech of one colour or another depending the political group. 
			<br><br>To know the composition of the chamber, we used the deputies information available in the web <a href="http://www.congreso.es/portal/page/portal/Congreso/Congreso/Diputados?_piref73_1333056_73_1333049_1333049.next_page=/wc/menuAbecedarioInicio&tipoBusqueda=completo&idLegislatura=10">Deputies</a>.</p>
			<img src="images/congres2.png" alt="Lista Diputados" width="1000" height="1000">
			<p><br> From here we have downloaded the different lists of deputies to screen the different speeches for political group. 
			<br><br> Finally, we we obtained a database that has a Python dictionary per control session divided in speeches which contain the question related, the speech, the depute and the political group. We save this database in MongoDB.	
			</p>
		</div>
		
		<div class="blog-post">
            <h2 class="blog-post-title">How we find the keywords of every speech?</h2>
			<p><br> In the Congress Database we can find 311 document and 7000 speeches. Classify all this by CIS clusters is a huge work so we make a plan: we would extract the keywords of each speech and create a dictionary with them to cluster all as maximum as documents as possible.
			<br><br>Since we were interested in the extraction of the main topics from our Corpus, we defined as a feature any n-gram keyword (a sequence of one or more words) within the Corpus. We noticed that that concepts, in general, are expressed by nouns, with or without adjectives, so, we focused on finding the way to extract nouns and adjectives from our documents.
			<br><br>We used an unsupervised algorithm called RAKE (Rapid Automatic Keyword Extraction). RAKE it is very simple and has only a parameter. This parameter is a stop list (in our case we customized this list in order to include all the words that are not noums or adjectives) and RAKE uses it to generate the co-occurrence graph formed by the candidates keywords. RAKE is also able to score the selected keywords. It works out the weight of each keyword as: deg(kw) / freq(kw).
			<br><br> Then we built the term-frequency matrix using the extracted keywords as a vocabulary (bag-of-the-words). After that, we used scikit-learn library to transform this matrix into a sparse matrix.
			<br><br> Once we obtained the sparse matrix we can apply a K-means algorithm, in particular "k-means++" to create the clusters. Once we have done several iterations of K-means we can identify clusters that were clearly identifiable with CIS topics.We managed to create a list of words affine with these topics in order to train a simple classifier. We used this classifier to classify the rest of documents.  
			<br><br> Eventually, we used the number of lines of each speech as a time reference obtaining several tables and dictionarys that are going to be used to make the charts. 
			</p>
		</div>
			
		<div class="blog-post">
            <h2 class="blog-post-title">The Charts</h2>
			<p><br> At the very beginning we wantet to imitate this <a href="http://www.nytimes.com/interactive/2012/09/06/us/politics/convention-word-counts.html">chart</a> from the NY Times but it was not enough for our purposes, it was very important for us to use the information from CIS. 
			<br><br> Having this goal in mind we created the radar and the analysis charts. Both of them with the objective to see how our preferences have changed on time. To do this charts we have used D3 program and we create transitions to make the visualization of the charts more dynamic. 
			<br><br> When we where close to finish this project, we found the incredible <a href="http://politilines.periscopic.com/">PolitiLines</a> and realised that we have all the information to do it: the clusters, the keywords and the political group match so we decided to create the Spanish version of it. 
			</p>
		</div>	

        </div><!-- /.blog-main -->

    </div><!-- /.container -->

    <footer class="blog-footer">
      <p>Blog template built for <a href="http://getbootstrap.com">Bootstrap</a> by <a href="https://twitter.com/mdo">@mdo</a>.</p>
      <p>
        <a href="#">Back to top</a>
      </p>
    </footer>


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
  

</body></html>